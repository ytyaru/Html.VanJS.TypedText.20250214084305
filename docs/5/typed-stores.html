<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title></title>
<meta name="description" content="">
<meta name="author" content="ytyaru">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">
<link rel="icon" href="../asset/image/author/ytyaru.png">
<link rel="stylesheet" href="css/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../lib/van/1.2.6/nomodule.min.js"></script>
<script src="../js/footer.js"></script>
<script src="../lib/util/type.js"></script>
<script src="../lib/util/test/assertion.js"></script>
<script src="../lib/util/array/eq.js"></script>
<script src="js/typed-text.js"></script>
<script src="js/type-stores.js"></script>
<!--<script src="js/main.js"></script>-->
<script>
window.addEventListener('DOMContentLoaded', async(event) => {
    const a = new Assertion();
    a.t('TypedText' in window)
    a.t('TypeStores' in window)
    a.t(()=>{
        console.log(TypeStores.typeNames)
        console.log(TypeStores.typeCls)
        console.log(TypeStores.getClsFromName('i32')===TypeStores.typeCls.Integer32TypeStore)
        console.log(TypeStores.getClsFromName('i32'), TypeStores.typeCls.Integer32TypeStore)
        console.log(TypeStores.getClsFromName('i32'), TypeStores.typeCls.Integer32TypeStore)
        const expected = ["BooleanTypeStore", "IntegerTypeStore", "Integer2TypeStore", "Integer8TypeStore", "Integer16TypeStore", "Integer32TypeStore", "Integer36TypeStore", "Integer64TypeStore", "FloatTypeStore", "NumberTypeStore", "BigIntTypeStore", "BigInt2TypeStore", "BigInt8TypeStore", "BigInt16TypeStore", "BigInt32TypeStore", "BigInt36TypeStore", "BigInt64TypeStore", "BlobTypeStore", "Binary64TypeStore", "Binary256TypeStore", "StringTypeStore", "AnyTypeStore"];
        return expected.eqV(TypeStores.typeNames)
    })
    a.t(()=>{return 22===TypeStores.typeClss.length && TypeStores.typeClss.every(c=>Type.isCls(c))});
    a.t(()=>{return 22===TypeStores.typeInss.length && TypeStores.typeInss.every(i=>Type.isIns(i))});
    // getClsFromName()
    a.t(TypeStores.getClsFromName('any')===TypeStores.typeCls.AnyTypeStore);
    a.t(TypeStores.getClsFromName('string')===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromName('str')===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromName('s')===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromName('boolean')===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromName('bool')===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromName('bln')===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromName('b')===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromName('integer')===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromName('int')===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromName('i')===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromName('integer2')===TypeStores.typeCls.Integer2TypeStore);
    a.t(TypeStores.getClsFromName('int2')===TypeStores.typeCls.Integer2TypeStore);
    a.t(TypeStores.getClsFromName('i2')===TypeStores.typeCls.Integer2TypeStore);
    a.t(TypeStores.getClsFromName('integer8')===TypeStores.typeCls.Integer8TypeStore);
    a.t(TypeStores.getClsFromName('int8')===TypeStores.typeCls.Integer8TypeStore);
    a.t(TypeStores.getClsFromName('i8')===TypeStores.typeCls.Integer8TypeStore);
    a.t(TypeStores.getClsFromName('integer16')===TypeStores.typeCls.Integer16TypeStore);
    a.t(TypeStores.getClsFromName('int16')===TypeStores.typeCls.Integer16TypeStore);
    a.t(TypeStores.getClsFromName('i16')===TypeStores.typeCls.Integer16TypeStore);
    a.t(TypeStores.getClsFromName('integer32')===TypeStores.typeCls.Integer32TypeStore);
    a.t(TypeStores.getClsFromName('int32')===TypeStores.typeCls.Integer32TypeStore);
    a.t(TypeStores.getClsFromName('i32')===TypeStores.typeCls.Integer32TypeStore);
    a.t(TypeStores.getClsFromName('integer36')===TypeStores.typeCls.Integer36TypeStore);
    a.t(TypeStores.getClsFromName('int36')===TypeStores.typeCls.Integer36TypeStore);
    a.t(TypeStores.getClsFromName('i36')===TypeStores.typeCls.Integer36TypeStore);
    a.t(TypeStores.getClsFromName('integer64')===TypeStores.typeCls.Integer64TypeStore);
    a.t(TypeStores.getClsFromName('int64')===TypeStores.typeCls.Integer64TypeStore);
    a.t(TypeStores.getClsFromName('i64')===TypeStores.typeCls.Integer64TypeStore);
    a.t(TypeStores.getClsFromName('float')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromName('flt')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromName('f')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromName('number')===TypeStores.typeCls.NumberTypeStore);
    a.t(TypeStores.getClsFromName('num')===TypeStores.typeCls.NumberTypeStore);
    a.t(TypeStores.getClsFromName('n')===TypeStores.typeCls.NumberTypeStore);
    a.t(TypeStores.getClsFromName('bigint')===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromName('bint')===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromName('bi')===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromName('I')===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromName('bigint2')===TypeStores.typeCls.BigInt2TypeStore);
    a.t(TypeStores.getClsFromName('bint2')===TypeStores.typeCls.BigInt2TypeStore);
    a.t(TypeStores.getClsFromName('bi2')===TypeStores.typeCls.BigInt2TypeStore);
    a.t(TypeStores.getClsFromName('I2')===TypeStores.typeCls.BigInt2TypeStore);
    a.t(TypeStores.getClsFromName('bigint8')===TypeStores.typeCls.BigInt8TypeStore);
    a.t(TypeStores.getClsFromName('bint8')===TypeStores.typeCls.BigInt8TypeStore);
    a.t(TypeStores.getClsFromName('bi8')===TypeStores.typeCls.BigInt8TypeStore);
    a.t(TypeStores.getClsFromName('I8')===TypeStores.typeCls.BigInt8TypeStore);
    a.t(TypeStores.getClsFromName('bigint16')===TypeStores.typeCls.BigInt16TypeStore);
    a.t(TypeStores.getClsFromName('bint16')===TypeStores.typeCls.BigInt16TypeStore);
    a.t(TypeStores.getClsFromName('bi16')===TypeStores.typeCls.BigInt16TypeStore);
    a.t(TypeStores.getClsFromName('I16')===TypeStores.typeCls.BigInt16TypeStore);
    a.t(TypeStores.getClsFromName('bigint32')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromName('bint32')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromName('bi32')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromName('I32')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromName('bigint36')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromName('bint36')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromName('bi36')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromName('I36')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromName('bigint64')===TypeStores.typeCls.BigInt64TypeStore);
    a.t(TypeStores.getClsFromName('bint64')===TypeStores.typeCls.BigInt64TypeStore);
    a.t(TypeStores.getClsFromName('bi64')===TypeStores.typeCls.BigInt64TypeStore);
    a.t(TypeStores.getClsFromName('I64')===TypeStores.typeCls.BigInt64TypeStore);
    a.t(TypeStores.getClsFromName('blob')===TypeStores.typeCls.BlobTypeStore);
    a.t(TypeStores.getClsFromName('binary64')===TypeStores.typeCls.Binary64TypeStore);
    a.t(TypeStores.getClsFromName('bin64')===TypeStores.typeCls.Binary64TypeStore);
    a.t(TypeStores.getClsFromName('binary256')===TypeStores.typeCls.Binary256TypeStore);
    a.t(TypeStores.getClsFromName('bin256')===TypeStores.typeCls.Binary256TypeStore);

    // getClsFromText
    a.t(TypeStores.getClsFromText('x')===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromText('v')===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromText('_')===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromText('0')===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromText(`${Number.MIN_SAFE_INTEGER}`)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromText(`${Number.MAX_SAFE_INTEGER}`)===TypeStores.typeCls.IntegerTypeStore);
    a.e(TypeError, `値は-9007199254740991〜9007199254740991の整数値になる文字列であるべきです。:-9007199254740992:-9007199254740992:10`, ()=>TypeStores.getClsFromText(`${Number.MIN_SAFE_INTEGER-1}`)===TypeStores.typeCls.IntegerTypeStore);
    a.e(TypeError, `値は-9007199254740991〜9007199254740991の整数値になる文字列であるべきです。:9007199254740992:9007199254740992:10`, ()=>TypeStores.getClsFromText(`${Number.MAX_SAFE_INTEGER+1}`)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromText(`${Infinity}`)===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromText(`${-Infinity}`)===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromText(`${NaN}`)===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromText('0.0')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromText('.0')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromText('-1.2')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromText('-.1')===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromText('0n')===TypeStores.typeCls.BigIntTypeStore);
    // 指数をNumber,Integer,Floatにすべき？　それともStringにすべき？
//    a.t(TypeStores.getClsFromText('2e3')===TypeStores.typeCls.NumberTypeStore); // 指数はNumber,Integer,Floatになる？
    a.t(TypeStores.getClsFromText('2e3')===TypeStores.typeCls.StringTypeStore); // 指数はStringになる？

    a.t(TypeStores.getClsFromText('0b11')===TypeStores.typeCls.Integer2TypeStore);
    a.t(TypeStores.getClsFromText('0o77')===TypeStores.typeCls.Integer8TypeStore);
    a.t(TypeStores.getClsFromText('0xff')===TypeStores.typeCls.Integer16TypeStore);
    a.t(TypeStores.getClsFromText('0xFF')===TypeStores.typeCls.Integer16TypeStore);
    a.t(TypeStores.getClsFromText('0vvv')===TypeStores.typeCls.Integer32TypeStore);
    a.t(TypeStores.getClsFromText('0vVV')===TypeStores.typeCls.Integer32TypeStore);
    a.t(TypeStores.getClsFromText('0zzz')===TypeStores.typeCls.Integer36TypeStore);
    a.t(TypeStores.getClsFromText('0zZZ')===TypeStores.typeCls.Integer36TypeStore);
    a.t(TypeStores.getClsFromText('0_//')===TypeStores.typeCls.Integer64TypeStore);

    a.t(TypeStores.getClsFromText('0B11')===TypeStores.typeCls.BigInt2TypeStore);
    a.t(TypeStores.getClsFromText('0O77')===TypeStores.typeCls.BigInt8TypeStore);
    a.t(TypeStores.getClsFromText('0Xff')===TypeStores.typeCls.BigInt16TypeStore);
    a.t(TypeStores.getClsFromText('0XFF')===TypeStores.typeCls.BigInt16TypeStore);
    console.log(TypeStores.getClsFromText('0Vvv'));
    console.log(/^0V[0-9a-vA-V]$/.test('0Vvv'))
    a.t(TypeStores.getClsFromText('0Vvv')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromText('0VVV')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromText('0Zzz')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromText('0ZZZ')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromText('0///')===TypeStores.typeCls.BigInt64TypeStore);
    a.t(TypeStores.getClsFromText('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAKZJREFUWEftl+EOgCAIhPH9H9rWj5qzA2TDYMz+lXPSd0dHjYKvFnw+vQV0oj4X02j/eh4CUVLkI3B7YdR+JuO9/iHgfYD2AqeAfCb8ux1rEuA6CT0XCYz5IH0bkGxatjx7akpgMbIrAU0ytO46D8zzw8q9KwEL+romtKbpScN6BKydUK8NUQhJPzzQAxpGz6kZSmDJcy6KUZGmeWA1zzlaq/vDTXgB6It0IRvncRQAAAAASUVORK5CYIIA')===TypeStores.typeCls.BlobTypeStore);
    console.log(TypeStores.getClsFromText('base64:YmFzZTY0Cg=='))
    console.log(TypeStores.getClsFromText('base256:⢀⠠⢠'))
    a.t(TypeStores.getClsFromText('base64:YmFzZTY0Cg==')===TypeStores.typeCls.Binary64TypeStore);
    a.t(TypeStores.getClsFromText('base256:⢀⠠⢠')===TypeStores.typeCls.Binary256TypeStore);

    // getClsFromValue
    a.t(TypeStores.getClsFromValue('x')===TypeStores.typeCls.StringTypeStore);
    a.t(TypeStores.getClsFromValue(true)===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromValue(false)===TypeStores.typeCls.BooleanTypeStore);
    a.t(TypeStores.getClsFromValue(0)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(0.0)===TypeStores.typeCls.IntegerTypeStore);//FloatでなくIntである
    a.t(TypeStores.getClsFromValue(+0)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(-0)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(0.1)===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromValue(.1)===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromValue(-.1)===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromValue(-0.1)===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromValue(-1.2e5)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(1.2e-5)===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromValue(-1.2e-5)===TypeStores.typeCls.FloatTypeStore);
    a.t(TypeStores.getClsFromValue(Number.MIN_SAFE_INTEGER)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(Number.MAX_SAFE_INTEGER)===TypeStores.typeCls.IntegerTypeStore);
    // 2^53の範囲を超過したらIntegerでなくNumber型にすべきでは？　あるいは例外発生させるべき？
    a.t(TypeStores.getClsFromValue(Number.MIN_SAFE_INTEGER-1)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(Number.MAX_SAFE_INTEGER+1)===TypeStores.typeCls.IntegerTypeStore);
//    a.e(TypeError, `値は-9007199254740991〜9007199254740991の整数値になる文字列であるべきです。:-9007199254740992:-9007199254740992:10`, ()=>TypeStores.getClsFromValue(`${Number.MIN_SAFE_INTEGER-1}`)===TypeStores.typeCls.IntegerTypeStore);
//    a.e(TypeError, `値は-9007199254740991〜9007199254740991の整数値になる文字列であるべきです。:9007199254740992:9007199254740992:10`, ()=>TypeStores.getClsFromValue(`${Number.MAX_SAFE_INTEGER+1}`)===TypeStores.typeCls.IntegerTypeStore);
//    console.log(Infinity, typeof Infinity, `${Infinity}`, parseInt(`${Infinity}`))
    console.log(TypeStores.getClsFromValue(Infinity))
    a.t(TypeStores.getClsFromValue(Infinity)===TypeStores.typeCls.NumberTypeStore);
    a.t(TypeStores.getClsFromValue(-Infinity)===TypeStores.typeCls.NumberTypeStore);
    a.t(TypeStores.getClsFromValue(NaN)===TypeStores.typeCls.AnyTypeStore); // NaNはJS的にはNumber型だが非数を意味し矛盾するのでTypedStoresとしてはAny型にする
    a.t(TypeStores.getClsFromValue(null)===TypeStores.typeCls.AnyTypeStore); // nullはJS的にはtypeofで"obuject"になるが、何も参照しない意味でありobjectと矛盾するのでTypedStoresとしてはAny型にする
    a.t(TypeStores.getClsFromValue(undefined)===TypeStores.typeCls.AnyTypeStore); // NaNはJS的には定数だが実際は例外を意味するのでTypedStoresとしてはAny型にする
    a.t(TypeStores.getClsFromValue(0n)===TypeStores.typeCls.BigIntTypeStore);
//    a.t(TypeStores.getClsFromValue(2e3)===TypeStores.typeCls.NumberTypeStore); // 指数はNumberになる？
    a.t(TypeStores.getClsFromValue(2e3)===TypeStores.typeCls.IntegerTypeStore); // 指数はStringになる？

    // 基数によるリテラル表現を使用しても、JS的にはNumber(Integer)型でしかない。基数2,8,16のような情報は失われてしまう。
    a.t(TypeStores.getClsFromValue(0b11)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(0o77)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(0xff)===TypeStores.typeCls.IntegerTypeStore);
    a.t(TypeStores.getClsFromValue(0xFF)===TypeStores.typeCls.IntegerTypeStore);
//    a.t(TypeStores.getClsFromValue(0b11)===TypeStores.typeCls.Integer2TypeStore);
//    a.t(TypeStores.getClsFromValue(0o77)===TypeStores.typeCls.Integer8TypeStore);
//    a.t(TypeStores.getClsFromValue(0xff)===TypeStores.typeCls.Integer16TypeStore);
//    a.t(TypeStores.getClsFromValue(0xFF)===TypeStores.typeCls.Integer16TypeStore);
//    a.t(TypeStores.getClsFromValue(0vvv)===TypeStores.typeCls.Integer32TypeStore);
//    a.t(TypeStores.getClsFromValue(0vVV)===TypeStores.typeCls.Integer32TypeStore);
//    a.t(TypeStores.getClsFromValue(0zzz)===TypeStores.typeCls.Integer36TypeStore);
//    a.t(TypeStores.getClsFromValue(0zZZ)===TypeStores.typeCls.Integer36TypeStore);
//    a.t(TypeStores.getClsFromValue(0_//)===TypeStores.typeCls.Integer64TypeStore);

    a.t(TypeStores.getClsFromValue(BigInt(Number.MIN_SAFE_INTEGER))===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromValue(BigInt(Number.MAX_SAFE_INTEGER))===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromValue(BigInt(Number.MIN_SAFE_INTEGER)-1n)===TypeStores.typeCls.BigIntTypeStore);
    a.t(TypeStores.getClsFromValue(BigInt(Number.MAX_SAFE_INTEGER)+1n)===TypeStores.typeCls.BigIntTypeStore);
     
    /*
    a.t(TypeStores.getClsFromValue('0B11')===TypeStores.typeCls.BigInt2TypeStore);
    a.t(TypeStores.getClsFromValue('0O77')===TypeStores.typeCls.BigInt8TypeStore);
    a.t(TypeStores.getClsFromValue('0Xff')===TypeStores.typeCls.BigInt16TypeStore);
    a.t(TypeStores.getClsFromValue('0XFF')===TypeStores.typeCls.BigInt16TypeStore);
    console.log(TypeStores.getClsFromValue('0Vvv'));
    console.log(/^0V[0-9a-vA-V]$/.test('0Vvv'))
    a.t(TypeStores.getClsFromValue('0Vvv')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromValue('0VVV')===TypeStores.typeCls.BigInt32TypeStore);
    a.t(TypeStores.getClsFromValue('0Zzz')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromValue('0ZZZ')===TypeStores.typeCls.BigInt36TypeStore);
    a.t(TypeStores.getClsFromValue('0///')===TypeStores.typeCls.BigInt64TypeStore);
    */
    a.t(()=>{//BlobTextValue.toValue()
        const dataUri = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAKZJREFUWEftl+EOgCAIhPH9H9rWj5qzA2TDYMz+lXPSd0dHjYKvFnw+vQV0oj4X02j/eh4CUVLkI3B7YdR+JuO9/iHgfYD2AqeAfCb8ux1rEuA6CT0XCYz5IH0bkGxatjx7akpgMbIrAU0ytO46D8zzw8q9KwEL+romtKbpScN6BKydUK8NUQhJPzzQAxpGz6kZSmDJcy6KUZGmeWA1zzlaq/vDTXgB6It0IRvncRQAAAAASUVORK5CYIIA';
        const blobType = TypeStores.getInsFromText(dataUri);
        console.log(blobType)
        console.log('toValue' in blobType)
        const blob = blobType.text.toValue(dataUri);
        const res = TypeStores.getClsFromValue(blob);
        console.log(res)
        return res===TypeStores.typeCls.BlobTypeStore;
    })
    a.t(async()=>{
        try {
            const dataUri = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAKZJREFUWEftl+EOgCAIhPH9H9rWj5qzA2TDYMz+lXPSd0dHjYKvFnw+vQV0oj4X02j/eh4CUVLkI3B7YdR+JuO9/iHgfYD2AqeAfCb8ux1rEuA6CT0XCYz5IH0bkGxatjx7akpgMbIrAU0ytO46D8zzw8q9KwEL+romtKbpScN6BKydUK8NUQhJPzzQAxpGz6kZSmDJcy6KUZGmeWA1zzlaq/vDTXgB6It0IRvncRQAAAAASUVORK5CYIIA';
            const blobType = TypeStores.getInsFromText(dataUri);
            console.log(blobType)
            console.log('toValue' in blobType)
            const blob = await blobType.text.toValueAsync(dataUri);
            const res = TypeStores.getClsFromValue(blob);
            console.log(res)
            return res===TypeStores.typeCls.BlobTypeStore;
        }catch(e){console.error(e)}
    })
//    console.log(TypeStores.getClsFromValue('base64:YmFzZTY0Cg=='))
//    console.log(TypeStores.getClsFromValue('base256:⢀⠠⢠'))
//    a.t(TypeStores.getClsFromValue('base64:YmFzZTY0Cg==')===TypeStores.typeCls.Binary64TypeStore);
//    a.t(TypeStores.getClsFromValue('base256:⢀⠠⢠')===TypeStores.typeCls.Binary256TypeStore);
    a.t(async()=>{// base64 という文字列をBase64化した
        try {
//            const base64 = 'base64:YmFzZTY0Cg==';  // 末尾に改行コード有り  echo base64 | base64 -w0
            const base64 = 'base64:YmFzZTY0'; // 末尾に改行コード無し  echo -n base64 | base64 -w0
            const base64Type = TypeStores.getInsFromText(base64);
            const res = await base64Type.text.toValue(base64);
            console.log(res)
            console.log((new TextDecoder()).decode(res))
            const resTxt = (new TextDecoder()).decode(res);
            console.log('base64'===resTxt)
            console.log((new TextEncoder()).encode('base64'))
            console.log((new TextEncoder()).encode(resTxt))
            return 'base64'===resTxt;
        } catch(e){console.error(e)}
    });
    a.t(async()=>{// 123 というバイナリ配列をBase64化した
        try {
            const buffer = new Uint8Array([1,2,3]);
            //const base64 = buffer.reduce((binStr, ui8) => binStr+String.fromCharCode(ui8),'');
            const base64 = `base64:${btoa(buffer.reduce((binStr, ui8) => binStr+String.fromCharCode(ui8),''))}`;
            console.log(base64)
            const base64Type = TypeStores.getInsFromText(base64);
            const res = await base64Type.text.toValue(base64);
            console.log(res, res.length, res[0], res[1], 1===res[0])
            return res instanceof Uint8Array && 1===res[0] && 2===res[1] && 3===res[2];
        } catch(e){console.error(e)}
    });
    a.t(async()=>{// 日本語 という文字列をBase64化した
        try {
            const base64 = 'base64:5pel5pys6Kqe'; // 末尾に改行コード無し  echo -n 日本語 | base64 -w0
            const base64Type = TypeStores.getInsFromText(base64);
            const res = await base64Type.text.toValue(base64);
            console.log(res)
            console.log((new TextDecoder()).decode(res))
            const resTxt = (new TextDecoder()).decode(res);
            console.log('日本語'===resTxt)
            console.log((new TextEncoder()).encode('日本語'))
            console.log((new TextEncoder()).encode(resTxt))
            return '日本語'===resTxt;
        } catch(e){console.error(e)}
    });
    a.t(async()=>{
        try {
            const type = TypeStores.getInsFromName('bin256');
            console.log(type)
            const base256 = type.value.toString((new TextEncoder()).encode('日本語'));
            console.log(base256, typeof base256);
            const res = type.text.toValue(base256);
            const resTxt = (new TextDecoder()).decode(res);
            console.log(resTxt);
            return '日本語'===resTxt;
        } catch(e){console.error(e)}
    })

    a.t(async()=>{
        const type = TypeStores.getInsFromName('blob');
        const dataUri = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAKZJREFUWEftl+EOgCAIhPH9H9rWj5qzA2TDYMz+lXPSd0dHjYKvFnw+vQV0oj4X02j/eh4CUVLkI3B7YdR+JuO9/iHgfYD2AqeAfCb8ux1rEuA6CT0XCYz5IH0bkGxatjx7akpgMbIrAU0ytO46D8zzw8q9KwEL+romtKbpScN6BKydUK8NUQhJPzzQAxpGz6kZSmDJcy6KUZGmeWA1zzlaq/vDTXgB6It0IRvncRQAAAAASUVORK5CYIIA';
        const blob = await type.text.toValueAsync(dataUri);
        const res = await type.value.toStringAsync(blob);
        return res===dataUri;
    });
    a.fin();
});
</script>
</head>
<body>
    <main></main>
    <footer></footer>
</body>
</html>
<!-- https://coliss.com/articles/build-websites/operation/work/html-template-for-web-apps-or-sites.html -->
<!-- https://coliss.com/articles/build-websites/operation/work/html5-template-for-2018.html -->
